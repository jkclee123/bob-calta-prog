{
  "id": "avalon",
  "name": {
    "en": "Avalon",
    "zh": "阿瓦隆"
  },
  "description": {
    "en": "Game helper for The Resistance: Avalon board game. Support functions like character drawing, timer, and playing quest cards.",
    "zh": "阿瓦隆抵抗組織桌遊助手，功能包括抽角色、計時同出任務。"
  },
  "image": "/images/programs/avalon.png",
  "mode": "Comp",
  "memory": 302,
  "status": "completed",
  "code": [
    {
      "line": 1,
      "code": "Lbl 0:Norm 2:60→M:?→M:",
      "bytes": 15,
      "cumulativeBytes": 15,
      "comment": {
        "en": "Main menu - function selection (default: 60 for timer 60 seconds)",
        "zh": "主選單 - 功能選擇（預設：60為計時60秒）"
      }
    },
    {
      "line": 2,
      "code": "Fix 0:M=0⇒Goto 2:M>5⇒Goto 1:M>0⇒Goto 8:",
      "bytes": 24,
      "cumulativeBytes": 39,
      "comment": {
        "en": "Route to different function based on input",
        "zh": "根據輸入跳轉不同功能"
      }
    },
    {
      "line": 3,
      "code": "-MRan#+.5◢",
      "bytes": 7,
      "cumulativeBytes": 46,
      "comment": {
        "en": "Function 1 - Generate random number",
        "zh": "功能1 - 打骰"
      }
    },
    {
      "line": 4,
      "code": "Lbl 1:50M→M:For 1→D To M:Next:Goto 0:",
      "bytes": 21,
      "cumulativeBytes": 67,
      "comment": {
        "en": "Function 2 - Timer",
        "zh": "功能2 - 計時"
      }
    },
    {
      "line": 5,
      "code": "Lbl 2:?→A:?→B:?→C:ClrStat:0DT:Lbl 3:A-n+1→Y:",
      "bytes": 31,
      "cumulativeBytes": 98,
      "comment": {
        "en": "Function 3 - Character drawing",
        "zh": "功能3 - 抽角色"
      }
    },
    {
      "line": 6,
      "code": "Rnd(10³Ran#÷Rnd(10³÷Y-.5)+.5→D:D>Y⇒Goto 3:",
      "bytes": 29,
      "cumulativeBytes": 127,
      "comment": {
        "en": "Generate random number",
        "zh": "生成隨機數"
      }
    },
    {
      "line": 7,
      "code": "∑x→M:-1→X:",
      "bytes": 9,
      "cumulativeBytes": 136,
      "comment": {
        "en": "Load ledger to running ledger",
        "zh": "載入數簿到運行數簿"
      }
    },
    {
      "line": 8,
      "code": "While D:D-(M<1→D:10(M-(M≥1→M:X+1→X:WhileEnd:",
      "bytes": 32,
      "cumulativeBytes": 168,
      "comment": {
        "en": "Find the actual card number",
        "zh": "搵出實際嘅牌號"
      }
    },
    {
      "line": 9,
      "code": "-Y◢₁₀^(-XDT:X-B→X:",
      "bytes": 14,
      "cumulativeBytes": 182,
      "comment": {
        "en": "Display the remaining number of cards",
        "zh": "顯示剩餘未抽牌數"
      }
    },
    {
      "line": 10,
      "code": "If X≥0:Then (Gσσ)⁻¹(69-(68-X)(X< C→D:GσσD◢",
      "bytes": 34,
      "cumulativeBytes": 216,
      "comment": {
        "en": "Display card for good loyalty",
        "zh": "顯示好人陣營角色"
      }
    },
    {
      "line": 11,
      "code": "Else -X÷BA→D:BAD◢IfEnd:",
      "bytes": 15,
      "cumulativeBytes": 231,
      "comment": {
        "en": "Display card for evil loyalty",
        "zh": "顯示壞人陣營角色"
      }
    },
    {
      "line": 12,
      "code": "Y>1⇒Goto 3:0→X:ClrStat:Goto 0:",
      "bytes": 16,
      "cumulativeBytes": 247,
      "comment": {
        "en": "Continue drawing cards until all cards are drawn",
        "zh": "繼續抽牌直至抽晒牌"
      }
    },
    {
      "line": 13,
      "code": "Lbl 8:0→X:For -M→M To -1:",
      "bytes": 16,
      "cumulativeBytes": 263,
      "comment": {
        "en": "Function 4 - Play quest card",
        "zh": "功能4 - 出任務"
      }
    },
    {
      "line": 14,
      "code": "Lbl 9:M→D:?→D:D≠0⇒D≠1⇒Goto 9:X+D→X:Next:",
      "bytes": 30,
      "cumulativeBytes": 293,
      "comment": {
        "en": "Play quest card: Success/Failure",
        "zh": "出任務：任務成功／失敗"
      }
    },
    {
      "line": 15,
      "code": "tFBσYZ₀◢X◢Goto 0",
      "bytes": 11,
      "cumulativeBytes": 304,
      "comment": {
        "en": "Display the number of failure quest cards",
        "zh": "顯示任務失敗卡數量"
      }
    }
  ],
  "usage": {
    "en": {
      "parameters": [
        "Main Menu:",
        "- M?: function selector (default: 60 for timer 60 seconds)",
        "Timer:",
        "- D: loop counter",
        "- M: timer target",        
        "Character Drawing:", 
        "- A: total number of players",
        "- B: number of players of evil loyalty",
        "- C: number of special characters of good loyalty",
        "- D: drawn random number/temporary variable",
        "- X: actual card number",
        "- Y: number of remaining cards",
        "- M: running drawn cards ledger",
        "- ∑x: drawn cards ledger",
        "- n: number of drawn cards + 1",
        "Play Quest Card:",
        "- X: number of failure quest cards",
        "- M: number of quest cards required",
        "- D: quest card type"
      ],
      "instructions": [
        "Run program, enter main menu and choose function:",
        "To run function 1 (random number), enter negative number to M to draw from 1 to -M",
        "To run function 2 (timer), enter positive number that is larger than 5 to M to start timer of M seconds",
        "To run function 3 (character drawing), enter zero to M to start character drawing",
        "To run function 4 (play quest card), enter positive number that is smaller than 5 to M to start playing M quest cards",
        "In function 3: character drawing, GσσD represents good loyalty character, BAD represents evil loyalty character. 69 represents loyal servant, user determines which character is represented by each number",
        "In function 4: play quest card, enter 0 to D to play quest success card, enter 1 to D to play quest failure card"
      ]
    },
    "zh": {
        "parameters": [
          "主選單：",
          "- M?: 功能選擇（預設：60為計時60秒）",
          "計時：",
          "- D: 循環計數",
          "- M: 計時目標",
          "抽角色：",
          "- A: 總玩家人數",
          "- B: 壞人陣營玩家人數",
          "- C: 好人陣營特殊角色人數",
          "- D: 抽出隨機數/暫存變數",
          "- X: 實際牌號",
          "- Y: 剩餘未抽牌數",
          "- M: 運行抽牌記錄",
          "- ∑x: 抽牌記錄",
          "- n: 抽咗牌數量 + 1",
          "出任務：",
          "- X: 任務失敗卡數量",
          "- M: 任務卡數量",
          "- D: 任務卡類型"
      ],
      "instructions": [
        "運行程式，進入主選單並選擇功能：",
        "選擇功能1（打骰），輸入負數到M以打骰1到-M",
        "選擇功能2（計時），輸入大過5嘅正數到M以計時M秒",
        "選擇功能3（抽角色），輸入零到M以開始抽角色",
        "選擇功能4（出任務），輸入細過5嘅正數到M以開始出M張任務卡",
        "喺功能3（抽角色），GσσD代表好人陣營角色，BAD代表壞人陣營角色。69代表平民，數字代表咩角色自己定",
        "喺功能4（出任務），輸入0到D出任務成功卡，輸入1到D出任務失敗卡"
      ]
    }
  },
  "examples": [
    {
      "title": {
        "en": "Function 1 - Generate random number",
        "zh": "功能1 - 打骰"
      },
      "steps": {
        "en": [
          "Input -3 to M (draw from 1 to 3)",
          "Program displays: 2 (random number)",
          "Returns to main menu"
        ],
        "zh": [
          "輸入-3到M（打骰1至3）",
          "程式顯示：2（隨機數）",
          "返回主選單"
        ]
      }
    },
    {
      "title": {
        "en": "Function 2 - Timer",
        "zh": "功能2 - 計時"
      },
      "steps": {
        "en": [
          "Input 60 to M (start timer of 60 seconds)",
          "Timer starts",
          "Program will display when timer reaches 0"
        ],
        "zh": [
          "輸入60到M（計時60秒）",
          "計時器開始",
          "程式會顯示計時器到0"
        ]
      }
    },
    {
      "title": {
        "en": "Function 3 - Character Drawing",
        "zh": "功能3 - 抽角色"
      },
      "steps": {
        "en": [
          "Input 0 to M (start character drawing)",
          "Input 10 to A (10 players)",
          "Input 3 to B (3 players of evil loyalty)",
          "Input 2 to C (2 special characters of good loyalty)",
          "Each player draw their character",
          "Returns to main menu"
        ],
        "zh": [
          "輸入0到M（開始抽角色）",
          "輸入10到A（10個玩家）",
          "輸入3到B（3個壞人陣營玩家）",
          "輸入2到C（2個好人陣營特殊角色）",
          "每個玩家抽角色",
          "返回主選單"
        ]
      }
    },
    {
      "title": {
        "en": "Function 4 - Play quest card",
        "zh": "功能4 - 出任務"
      },
      "steps": {
        "en": [
          "Input 5 to M (start playing 5 quest cards)",
          "Each player play their quest card",
          "Input 0 to D to play quest success card",
          "Input 1 to D to play quest failure card",
          "Program displays 1 in X, there is 1 quest failure card",
          "Returns to main menu"
        ],
        "zh": [
          "輸入5到M（開始出5張任務卡）",
          "每個玩家出任務卡",
          "輸入0到D出任務成功卡",
          "輸入1到D出任務失敗卡",
          "程式顯示1喺X，有1張任務失敗卡",
          "返回主選單"
        ]
      }
    }
  ],
  "analysis": [
    {
      "title": {
        "en": "Draw character cards without replacement",
        "zh": "唔重複抽角色卡"
      },
      "actualCode": [
        "Lbl 3:A-n+1→Y:",
        "Rnd(10³Ran#÷Rnd(10³÷Y-.5)+.5→D:D>Y⇒Goto 3:",
        "∑x→M:-1→X:",
        "While D:D-(M<1→D:10(M-(M≥1→M:X+1→X:WhileEnd:",
        "₁₀^(-XDT:Y>1⇒Goto 3:"
      ],
      "problem": {
        "en": "Design a way to draw character cards without replacement.",
        "zh": "設計一個不放回抽樣嘅方法"
      },
      "steps": [
        {
          "step": 1,
          "formula": "Lbl 3:A-n+1→Y",
          "title": {
            "en": "Deciding Which Available Card to Pick",
            "zh": "決定要抽第幾張「剩低嘅牌」"
          },
          "explanation": {
            "en": "First, the program doesn't pick a final card number directly. Instead, it determines how many cards are left to be drawn (`Y`). Then, it generates a random number `D` from 1 to `Y`. This number `D` represents the target, for instance, \"pick the 3rd available card\".",
            "zh": "首先，程式唔係直接抽一個牌嘅號碼。佢會先計下仲有幾多張牌未抽（`Y`），然後喺 1 同 `Y` 之間整個隨機數 `D` 出嚟。呢個 `D` 就係目標，例如話「我要抽剩低啲牌入面嘅第 3 張」"
          }
        },
        {
          "step": 2,
          "formula": "₁₀^(-X) DT",
          "title": {
            "en": "Using a \"Digital Ledger\" to Remember Drawn Cards",
            "zh": "用「電子數簿」記低抽咗嘅牌"
          },
          "explanation": {
            "en": "The core of this program is a \"digital ledger\" (`∑x`). It uses decimal places as flags. If card #3 is drawn, it adds 10^(-3) (0.001) to the ledger. If card #7 is drawn next, it adds 10^(-7), making the ledger 0.0010001. By checking which decimal places have a '1', the program knows which cards are unavailable. The `₁₀^(-X) DT` command is what adds this \"flag\" to the ledger after a card `X` is successfully drawn.",
            "zh": "呢個程式嘅核心係一本「電子數簿」（`∑x`），佢用小數點後嘅位嚟做標記。如果抽中咗 3 號牌，佢就將 10^(-3)（即係 0.001）加入數簿。如果下次抽中 7 號，就再加 10^(-7)，本數簿就會變成 0.0010001。只要睇下邊個小數位係「1」，程式就知道邊張牌已經冇咗。`₁₀^(-X) DT` 呢個指令就係喺抽完一張牌 `X` 之後，將呢個「標記」加入數簿嘅動作。"
          }
        },
        {
          "step": 3,
          "formula": "While D:D-(M<1→D:...",
          "title": {
            "en": "The Countdown Logic",
            "zh": "倒數嘅邏輯"
          },
          "explanation": {
            "en": "This loop finds the Dth card that is not drawn. Inside the loop, the code `D-(M<1)→D` checks if the current card is available. The condition `M<1` is only true (evaluates to 1) if the card's 'flag' in the ledger is 0. If it's true, `D` is decreased by 1. In simple terms: 'If the card is free, count down D by one.'",
            "zh": "呢個迴圈會搵出第 D 張未被抽嘅牌。喺迴圈入面，`D-(M<1)→D` 呢句會檢查而家張牌係咪抽過，只有當張牌喺數簿嘅「標記」係0，`M<1` 先會成立。如果成立，`D` 就會減1。簡單嚟講就係：「如果張牌未被人抽，就將 `D` 倒數一格。」"
          }
        },
        {
          "step": 4,
          "formula": "While D:...10(M-(M≥1→M:...",
          "title": {
            "en": "Reading the \"Digital Ledger\"",
            "zh": "查閱「電子數簿」"
          },
          "explanation": {
            "en": "How does the program check the next card in the next loop? This is handled by `10(M-(M≥1))→M`. This command modifies the running ledger `M` for the next check. It effectively shifts the decimal point one place to the right, so in the next pass of the loop, it will be inspecting the *next* card's availability flag. Think of it as turning the page of the ledger to get ready to read the next entry.",
            "zh": "程式點樣喺下一次迴圈檢查下一張牌呢？就係靠 `10(M-(M≥1))→M` 呢句。呢個技巧會改動緊運行中嘅數簿 `M`，為下一次檢查做準備。佢嘅效果等於將小數點向右移一個位，咁樣喺下一次迴圈，程式就會檢查到*下一張牌*嘅狀態。你可以當佢係揭開數簿嘅新一頁，準備讀下一個記錄。"
          }
        },
        {
          "step": 5,
          "formula": "While D:...X+1→X:WhileEnd:",
          "title": {
            "en": "Checking Cards",
            "zh": "檢查卡牌同結束迴圈"
          },
          "explanation": {
            "en": "The `X+1→X` part simply increments the actual card number, it means the Xth card. The `WhileEnd` marks the end of a single check. The entire process (checking the ledger, counting down `D` if needed, and moving to the next card `X`) repeats until `D` finally becomes zero. At that moment, the loop stops, and the current value of `X` is our randomly selected card.",
            "zh": "`X+1→X`搵出實際號碼，即係第X張牌。`WhileEnd` 標記住一次檢查嘅結束。成個過程（查數簿、喺需要時將 `D` 減一、然後移到下一張牌 `X`）會不斷重複，直到 `D` 最終變成零為止。喺嗰一刻，迴圈就會停止，而當時 `X` 嘅數值，就係我哋隨機抽中嘅牌。"
          }
        },
        {
          "step": 6,
          "formula": "Y>1⇒Goto 3",
          "title": {
            "en": "Repeat Until All Cards are Drawn",
            "zh": "重複直至抽晒所有牌"
          },
          "explanation": {
            "en": "Finally, the command `Y>1⇒Goto 3:` checks if there is more than one card left to be drawn. If true, the program loops back to the beginning (`Lbl 3`) to draw the next card, using the updated digital ledger to ensure no card is ever drawn twice.",
            "zh": "最後，`Y>1⇒Goto 3:` 呢句指令會檢查係咪仲有多過一張牌未抽。如果係，程式就會跳返去開頭（`Lbl 3`）抽下一張牌，而因為本電子數簿已經更新咗，所以可以確保唔會重複抽到同一張牌。"
          }
        }
      ]
    }
  ]
}